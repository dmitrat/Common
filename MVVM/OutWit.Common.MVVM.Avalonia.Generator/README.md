# OutWit.Common.MVVM.Avalonia.Generator

Roslyn Source Generator for automatic Avalonia `StyledProperty`, `DirectProperty`, and `AttachedProperty` generation. This generator reads properties marked with the corresponding attributes and generates the necessary property fields and implementations at compile time.

## ?? Important: Don't Install Directly

**This package should NOT be installed directly!** It's automatically included when you install `OutWit.Common.MVVM.Avalonia`.

```bash
# ? Correct - Install the Avalonia package
dotnet add package OutWit.Common.MVVM.Avalonia

# ? Wrong - Don't install the generator directly
dotnet add package OutWit.Common.MVVM.Avalonia.Generator
```

## What It Does

This source generator:

1. **Finds Properties** - Scans your code for properties marked with:
   - `[StyledProperty]` - generates Avalonia `StyledProperty`
   - `[DirectProperty]` - generates Avalonia `DirectProperty` with backing field
   - `[AttachedProperty]` - generates Avalonia `AttachedProperty`

2. **Generates Code** - Creates:
   - `public static readonly StyledProperty<T>` / `DirectProperty<TOwner, T>` / `AttachedProperty<T>` fields
   - Backing fields for `DirectProperty`
   - `Get{PropertyName}` and `Set{PropertyName}` methods for attached properties

3. **Convention-Based Discovery** - Automatically finds callback methods:
   - `On{PropertyName}Changed` for property changed handlers
   - `{PropertyName}Coerce` for coerce callbacks

## How It Works

### Input (Your Code)

```csharp
using Avalonia.Controls;
using OutWit.Common.MVVM.Avalonia.Attributes;

namespace MyApp.Controls
{
    public partial class CustomButton : Button
    {
        [StyledProperty(DefaultValue = "Click Me")]
        public string Label { get; set; }

        [DirectProperty(DefaultValue = 0)]
        public int ClickCount { get; set; }

        // Convention: On{PropertyName}Changed
        private void OnLabelChanged(AvaloniaPropertyChangedEventArgs<string> e)
        {
            UpdateLabel();
        }
    }
}
```

### Output (Generated Code)

```csharp
// <auto-generated/>
#nullable enable

namespace MyApp.Controls
{
    partial class CustomButton
    {
        public static readonly StyledProperty<string> LabelProperty =
            AvaloniaProperty.Register<CustomButton, string>(nameof(Label), "Click Me");

        private int m_clickCount = 0;

        public static readonly DirectProperty<CustomButton, int> ClickCountProperty =
            AvaloniaProperty.RegisterDirect<CustomButton, int>(
                nameof(ClickCount), 
                o => o.m_clickCount, 
                (o, v) => o.m_clickCount = v,
                unsetValue: 0);
    }
}
```

## Features

### ? Three Property Types

| Type | Use Case | Style System |
|------|----------|--------------|
| `StyledProperty` | Most properties | Yes |
| `DirectProperty` | Frequently changing values | No |
| `AttachedProperty` | Properties on other objects | Yes |

### ?? Convention-Based Callbacks
- Automatically finds `On{PropertyName}Changed` methods
- Automatically finds `{PropertyName}Coerce` methods

### ?? Attached Properties
```csharp
public static partial class MyAttachedProperties
{
    [AttachedProperty(DefaultValue = false)]
    public static bool IsHighlighted { get; set; }
}

// Generates:
// - public static readonly AttachedProperty<bool> IsHighlightedProperty
// - public static bool GetIsHighlighted(AvaloniaObject obj)
// - public static void SetIsHighlighted(AvaloniaObject obj, bool value)
```

## Requirements

- **.NET SDK**: 6.0 or later
- **Target Framework**: net6.0 or later
- **Platform**: Cross-platform (Avalonia)

## Troubleshooting

### Generated Code Not Appearing

1. Clean and rebuild: `dotnet clean && dotnet build`
2. Ensure class is marked as `partial`
3. Check using directive: `using OutWit.Common.MVVM.Avalonia.Attributes;`

### View Generated Files

```xml
<PropertyGroup>
    <EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>
    <CompilerGeneratedFilesOutputPath>$(BaseIntermediateOutputPath)Generated</CompilerGeneratedFilesOutputPath>
</PropertyGroup>
```

## Related Packages

- **OutWit.Common.MVVM.Avalonia** - Main Avalonia package (install this!)
- **OutWit.Common.MVVM** - Cross-platform base classes

## License

Non-Commercial License (NCL) - Free for personal, educational, and research purposes.  
For commercial use, contact licensing@ratner.io.

---

**Remember:** This package is automatically included with `OutWit.Common.MVVM.Avalonia`. Don't install it separately!
