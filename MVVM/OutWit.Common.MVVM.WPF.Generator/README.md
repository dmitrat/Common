# OutWit.Common.MVVM.WPF.Generator

Roslyn Source Generator for automatic WPF `DependencyProperty` generation. This generator reads properties marked with `[StyledProperty]` or `[AttachedProperty]` attributes and generates the necessary `DependencyProperty` fields and implementations at compile time.

## ?? Important: Don't Install Directly

**This package should NOT be installed directly!** It's automatically included when you install `OutWit.Common.MVVM.WPF`.

```bash
# ? Correct - Install the WPF package
dotnet add package OutWit.Common.MVVM.WPF

# ? Wrong - Don't install the generator directly
dotnet add package OutWit.Common.MVVM.WPF.Generator
```

## What It Does

This source generator:

1. **Finds Properties** - Scans your code for properties marked with:
   - `[StyledProperty]` - generates instance `DependencyProperty`
   - `[AttachedProperty]` - generates attached `DependencyProperty`

2. **Generates Code** - Creates:
   - `public static readonly DependencyProperty` fields
   - Property getter/setter implementations using `GetValue`/`SetValue`
   - `Get{PropertyName}` and `Set{PropertyName}` methods for attached properties
   - `PropertyMetadata` or `FrameworkPropertyMetadata` with specified options

3. **Convention-Based Discovery** - Automatically finds callback methods:
   - `On{PropertyName}Changed` for PropertyChangedCallback
   - `{PropertyName}Coerce` for CoerceValueCallback

## How It Works

### Input (Your Code)

```csharp
using System.Windows.Controls;
using OutWit.Common.MVVM.WPF.Attributes;

namespace MyApp.Controls
{
    public partial class CustomButton : Button
    {
        [StyledProperty(DefaultValue = "Click Me", AffectsMeasure = true)]
        public string Label { get; set; }

        [StyledProperty]
        public double IconSize { get; set; }

        // Convention: On{PropertyName}Changed
        private static void OnLabelChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            var button = (CustomButton)d;
            button.UpdateLabel();
        }
    }
}
```

### Output (Generated Code)

```csharp
// <auto-generated/>
#nullable enable

namespace MyApp.Controls
{
    partial class CustomButton
    {
        public static readonly DependencyProperty LabelProperty =
            DependencyProperty.Register(
                nameof(Label), 
                typeof(string), 
                typeof(CustomButton),
                new FrameworkPropertyMetadata(
                    "Click Me", 
                    FrameworkPropertyMetadataOptions.AffectsMeasure, 
                    OnLabelChanged));

        public static readonly DependencyProperty IconSizeProperty =
            DependencyProperty.Register(
                nameof(IconSize), 
                typeof(double), 
                typeof(CustomButton));
    }
}
```

## Features

### ? Automatic Generation
- No manual `DependencyProperty` boilerplate
- Compile-time generation
- Full IntelliSense support

### ?? Convention-Based Callbacks
- Automatically finds `On{PropertyName}Changed` methods
- Automatically finds `{PropertyName}Coerce` methods

### ?? Metadata Options
- `AffectsMeasure`, `AffectsArrange`, `AffectsRender`
- `BindsTwoWayByDefault`, `Inherits`
- `PropertyChangedCallback`, `CoerceValueCallback`

### ?? Attached Properties
```csharp
public static partial class MyAttachedProperties
{
    [AttachedProperty(DefaultValue = false)]
    public static bool IsHighlighted { get; set; }
}
```

## Requirements

- **.NET SDK**: 6.0 or later
- **Target Framework**: net6.0-windows or later
- **Platform**: WPF (Windows only)

## Troubleshooting

### Generated Code Not Appearing

1. Clean and rebuild: `dotnet clean && dotnet build`
2. Ensure class is marked as `partial`
3. Check using directive: `using OutWit.Common.MVVM.WPF.Attributes;`

### View Generated Files

```xml
<PropertyGroup>
    <EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>
    <CompilerGeneratedFilesOutputPath>$(BaseIntermediateOutputPath)Generated</CompilerGeneratedFilesOutputPath>
</PropertyGroup>
```

## Related Packages

- **OutWit.Common.MVVM.WPF** - Main WPF package (install this!)
- **OutWit.Common.MVVM** - Cross-platform base classes

## License

Non-Commercial License (NCL) - Free for personal, educational, and research purposes.  
For commercial use, contact licensing@ratner.io.

---

**Remember:** This package is automatically included with `OutWit.Common.MVVM.WPF`. Don't install it separately!
